import{Q as k}from"./QImg-DpsN3TG6.js";import{j as E,O as L,l as B,ap as D,_ as O,c as V,o as c,w as d,a as s,b as t,a6 as F,Q as j,e as N,d as g,aj as P,a7 as b,ag as y,t as v,a4 as w,af as A,f as C,p as H,ah as R,ai as G,aw as M}from"./index-BvqViaFu.js";import{Q as Y}from"./QHeader-D9H2_lZX.js";import{Q as T,a as z}from"./QFile-C4gIGOVD.js";import{Q as J}from"./QTooltip-BH1kcS3o.js";import{Q as K}from"./QSpace-jpp_q1W5.js";import{Q as W,a as X}from"./QForm-n188TVHB.js";import{Q as Z}from"./QMarkupTable-D6v1G9c6.js";import{Q as $,a as ee}from"./QInnerLoading-CG1cMuu8.js";import{Q as te}from"./QPage-ibmn56CW.js";import{b as se,c as ae}from"./QLayout-B6hBMmeb.js";import"./QItemLabel-CPAZKU5z.js";import"./format-Dp24duJg.js";const re=E({name:"QSlideTransition",props:{appear:Boolean,duration:{type:Number,default:300}},emits:["show","hide"],setup(a,{slots:e,emit:u}){let h=!1,o,r,l=null,m=null,i,q;function x(){o?.(),o=null,h=!1,l!==null&&(clearTimeout(l),l=null),m!==null&&(clearTimeout(m),m=null),r?.removeEventListener("transitionend",i),i=null}function I(n,p,f){p!==void 0&&(n.style.height=`${p}px`),n.style.transition=`height ${a.duration}ms cubic-bezier(.25, .8, .50, 1)`,h=!0,o=f}function Q(n,p){n.style.overflowY=null,n.style.height=null,n.style.transition=null,x(),p!==q&&u(p)}function U(n,p){let f=0;r=n,h===!0?(x(),f=n.offsetHeight===n.scrollHeight?0:void 0):(q="hide",n.style.overflowY="hidden"),I(n,f,p),l=setTimeout(()=>{l=null,n.style.height=`${n.scrollHeight}px`,i=_=>{m=null,(Object(_)!==_||_.target===n)&&Q(n,"show")},n.addEventListener("transitionend",i),m=setTimeout(i,a.duration*1.1)},100)}function S(n,p){let f;r=n,h===!0?x():(q="show",n.style.overflowY="hidden",f=n.scrollHeight),I(n,f,p),l=setTimeout(()=>{l=null,n.style.height=0,i=_=>{m=null,(Object(_)!==_||_.target===n)&&Q(n,"hide")},n.addEventListener("transitionend",i),m=setTimeout(i,a.duration*1.1)},100)}return L(()=>{h===!0&&x()}),()=>B(D,{css:!1,appear:a.appear,onEnter:U,onLeave:S},e.default)}}),le={name:"RegistroGrupo",data(){return{areas:[],loadingAreas:!1,submitting:!1,selectedAreaId:null,grupoNombre:"",pagoFile:null,integrantes:[],maxAreas:3}},computed:{areaOptions(){return this.areas},selectedArea(){return this.areas.find(a=>a.id===this.selectedAreaId)||null},allowedCourses(){if(!this.selectedArea)return[];const a=[];for(let e=1;e<=6;e++){const u=this.selectedArea[`curso${e}`];u&&a.push({label:u})}return a},req(){return a=>!!a||"Obligatorio"}},mounted(){this.fetchAreas()},methods:{formatDate(a){if(!a)return"";try{const[e,u,h]=a.split("-").map(Number);return new Date(e,u-1,h).toLocaleDateString("es-BO",{year:"numeric",month:"long",day:"numeric"})}catch{return a}},async fetchAreas(){this.loadingAreas=!0;try{const{data:a}=await this.$axios.get("/areas");this.areas=a||[]}catch{this.$q.notify({type:"negative",message:"No se pudieron cargar las áreas"})}finally{this.loadingAreas=!1}},onAreaChange(){this.integrantes=[],this.selectedArea&&this.agregarIntegrante()},agregarIntegrante(){this.selectedArea&&(this.integrantes.length>=10||this.integrantes.push({nombre:"",ci:"",tutor:"",telefono:"",curso:"",_areasCount:void 0}))},quitarIntegrante(a){this.integrantes.splice(a,1)},async checkAreasPorCi(a){const e=this.integrantes[a]?.ci;if(e)try{const{data:u}=await this.$axios.get(`/inscritos/areas-por-ci/${encodeURIComponent(e)}`);this.integrantes[a]._areasCount=Number(u?.areas??0),this.integrantes[a]._areasCount>=this.maxAreas&&this.$q.notify({type:"warning",message:`El CI ${e} ya está en ${this.integrantes[a]._areasCount} área(s). Máximo permitido: ${this.maxAreas}.`})}catch{this.$q.notify({type:"warning",message:"No se pudo verificar áreas del CI"})}},async onSubmit(){if(!this.selectedAreaId||this.integrantes.length===0){this.$q.notify({type:"negative",message:"Completa área e integrantes"});return}for(const e of this.integrantes)if((e._areasCount??0)>=this.maxAreas){this.$q.notify({type:"negative",message:`El CI ${e.ci} superó el máximo de áreas`});return}const a=new FormData;a.append("area_id",this.selectedAreaId),this.grupoNombre&&a.append("grupo_nombre",this.grupoNombre),this.pagoFile&&a.append("pago1",this.pagoFile),this.integrantes.forEach((e,u)=>{a.append(`integrantes[${u}][nombre]`,e.nombre),a.append(`integrantes[${u}][ci]`,e.ci),a.append(`integrantes[${u}][tutor]`,e.tutor||""),a.append(`integrantes[${u}][telefono]`,e.telefono||""),a.append(`integrantes[${u}][curso]`,e.curso)}),this.submitting=!0;try{const e=await this.$axios.post("/inscritos",a,{headers:{"Content-Type":"multipart/form-data"}});this.$q.notify({type:"positive",message:"Inscripción registrada"}),this.resetForm()}catch(e){const u=e?.response?.data?.message||"Error al registrar";this.$q.notify({type:"negative",message:u})}finally{this.submitting=!1}},resetForm(){this.selectedAreaId=null,this.grupoNombre="",this.pagoFile=null,this.integrantes=[]}}},ne={class:"row items-center q-py-sm q-px-md"},oe={class:"row q-col-gutter-md justify-center"},ie={class:"col-12 col-md-10"},de={class:"row q-col-gutter-md"},ue={class:"col-12 col-md-6"},me={key:0,class:"col-12 col-md-6"},ce={class:"row q-col-gutter-xs"},ge={key:0,class:"col-auto"},pe={class:"bg-blue-9 q-pa-xs text-white text-weight-bold"},he={key:1,class:"col-auto"},fe={class:"bg-green-9 q-pa-xs text-white text-weight-bold"},_e={key:2,class:"col-auto"},be={class:"bg-teal-9 q-pa-xs text-white text-weight-bold"},ye={key:3,class:"col-auto"},ve={class:"bg-indigo-9 q-pa-xs text-white text-weight-bold"},we={class:"row q-col-gutter-md q-mt-sm"},Ae={class:"col-12 col-md-6"},xe={class:"col-12 col-md-6"},Ce={class:"row items-center q-mt-md"},qe={class:"q-mt-sm"},Ve={class:"text-grey-7"},Ie={style:{"min-width":"200px"}},Qe={style:{"min-width":"140px"}},ke={style:{"min-width":"130px"}},Fe={style:{"min-width":"170px"}},Ne={class:"text-right"},Te={class:"row q-mt-lg q-gutter-sm"};function Ue(a,e,u,h,o,r){return c(),V(ae,{view:"lHh Lpr lFf"},{default:d(()=>[s(Y,{elevated:"",class:"bg-primary text-white"},{default:d(()=>[t("div",ne,[s(k,{src:"images.png",style:{width:"44px"},class:"q-mr-md"}),e[3]||(e[3]=t("div",{class:"col text-center"},[t("div",{class:"text-subtitle2"},"VIII OLIMPIADA DE"),t("div",{class:"text-h6 text-weight-bold"},"CIENCIA Y TECNOLOGÍA F.N.I.")],-1)),s(k,{src:"logo_fni.png",style:{width:"44px"}})]),s(F,{color:"white"})]),_:1}),s(se,null,{default:d(()=>[s(te,{class:"q-pa-md bg-grey-3"},{default:d(()=>[t("div",oe,[t("div",ie,[s(j,{flat:"",bordered:"",class:"bg-white"},{default:d(()=>[s(N,{class:"row items-center"},{default:d(()=>[s(g,{name:"groups",size:"md",class:"q-mr-sm text-primary"}),e[4]||(e[4]=t("div",{class:"text-h6"},"Registro de Grupo",-1))]),_:1,__:[4]}),s(F),s(N,null,{default:d(()=>[s(W,{onSubmit:P(r.onSubmit,["prevent"]),ref:"formRef"},{default:d(()=>[t("div",de,[t("div",ue,[s(T,{filled:"",dense:"",modelValue:o.selectedAreaId,"onUpdate:modelValue":[e[0]||(e[0]=l=>o.selectedAreaId=l),r.onAreaChange],options:r.areaOptions,"option-value":"id","option-label":"area","emit-value":"","map-options":"",label:"Selecciona el Área",loading:o.loadingAreas,rules:[l=>!!l||"El área es obligatoria"]},{prepend:d(()=>[s(g,{name:"school"})]),_:1},8,["modelValue","options","loading","rules","onUpdate:modelValue"])]),r.selectedArea?(c(),y("div",me,[t("div",ce,[r.selectedArea.fecha1?(c(),y("div",ge,[t("div",pe,v(r.selectedArea.titulo_fecha1||"Fecha 1")+": "+v(r.formatDate(r.selectedArea.fecha1)),1)])):b("",!0),r.selectedArea.fecha2?(c(),y("div",he,[t("div",fe,v(r.selectedArea.titulo_fecha2||"Fecha 2")+": "+v(r.formatDate(r.selectedArea.fecha2)),1)])):b("",!0),r.selectedArea.lugar?(c(),y("div",_e,[t("div",be,[s(g,{name:"place",class:"q-mr-xs"}),w(" "+v(r.selectedArea.lugar),1)])])):b("",!0),r.selectedArea.modalidad?(c(),y("div",ye,[t("div",ve,[s(g,{name:"meeting_room",class:"q-mr-xs"}),w(" "+v(r.selectedArea.modalidad),1)])])):b("",!0)])])):b("",!0)]),t("div",we,[t("div",Ae,[s(A,{modelValue:o.grupoNombre,"onUpdate:modelValue":e[1]||(e[1]=l=>o.grupoNombre=l),label:"Nombre del Grupo (opcional)",filled:"",dense:"",maxlength:"255"},{prepend:d(()=>[s(g,{name:"badge"})]),_:1},8,["modelValue"])]),t("div",xe,[s(z,{modelValue:o.pagoFile,"onUpdate:modelValue":e[2]||(e[2]=l=>o.pagoFile=l),label:"Comprobante de pago (png/jpg/pdf, máx 5MB)",filled:"",dense:"",counter:!0,accept:".png,.jpg,.jpeg,.pdf",clearable:""},{prepend:d(()=>[s(g,{name:"attach_file"})]),append:d(()=>[s(g,{name:"info",class:"cursor-pointer"},{default:d(()=>[s(J,null,{default:d(()=>e[5]||(e[5]=[w("Adjunta una imagen o PDF del pago")])),_:1,__:[5]})]),_:1})]),_:1},8,["modelValue"])])]),t("div",Ce,[s(g,{name:"assignment_ind",class:"q-mr-sm text-primary"}),e[6]||(e[6]=t("div",{class:"text-subtitle1"},"Integrantes",-1)),s(K),s(C,{unelevated:"",color:"primary",icon:"person_add",label:"Agregar",onClick:r.agregarIntegrante,disable:!r.selectedArea||o.integrantes.length>=10},null,8,["onClick","disable"])]),r.selectedArea?(c(),V(X,{key:0,class:"q-mt-sm bg-grey-1"},{avatar:d(()=>[s(g,{name:"info",color:"primary"})]),default:d(()=>[e[7]||(e[7]=w(" Puedes registrar hasta ")),e[8]||(e[8]=t("b",null,"10",-1)),e[9]||(e[9]=w(" integrantes por grupo. Los ")),e[10]||(e[10]=t("b",null,"cursos",-1)),e[11]||(e[11]=w(" dependen del área seleccionada. "))]),_:1,__:[7,8,9,10,11]})):b("",!0),s(re,null,{default:d(()=>[H(t("div",qe,[s(Z,{flat:"",bordered:""},{default:d(()=>[e[12]||(e[12]=t("thead",null,[t("tr",null,[t("th",null,"#"),t("th",null,"Nombre"),t("th",null,"CI"),t("th",null,"Tutor"),t("th",null,"Teléfono"),t("th",null,"Curso"),t("th")])],-1)),t("tbody",null,[(c(!0),y(R,null,G(o.integrantes,(l,m)=>(c(),y("tr",{key:m},[t("td",Ve,v(m+1),1),t("td",Ie,[s(A,{dense:"",filled:"",modelValue:l.nombre,"onUpdate:modelValue":i=>l.nombre=i,rules:[r.req]},null,8,["modelValue","onUpdate:modelValue","rules"])]),t("td",Qe,[s(A,{dense:"",filled:"",modelValue:l.ci,"onUpdate:modelValue":i=>l.ci=i,rules:[r.req],onBlur:i=>r.checkAreasPorCi(m)},{append:d(()=>[l._areasCount!==void 0?(c(),V(g,{key:0,name:l._areasCount>=o.maxAreas?"warning":"check_circle",color:l._areasCount>=o.maxAreas?"orange":"positive"},null,8,["name","color"])):b("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue","rules","onBlur"])]),t("td",null,[s(A,{dense:"",filled:"",modelValue:l.tutor,"onUpdate:modelValue":i=>l.tutor=i},null,8,["modelValue","onUpdate:modelValue"])]),t("td",ke,[s(A,{dense:"",filled:"",modelValue:l.telefono,"onUpdate:modelValue":i=>l.telefono=i},null,8,["modelValue","onUpdate:modelValue"])]),t("td",Fe,[s(T,{dense:"",filled:"",modelValue:l.curso,"onUpdate:modelValue":i=>l.curso=i,options:r.allowedCourses,"option-value":"label","option-label":"label","emit-value":"","map-options":"",rules:[r.req]},null,8,["modelValue","onUpdate:modelValue","options","rules"])]),t("td",Ne,[s(C,{flat:"",round:"",dense:"",icon:"delete",color:"negative",onClick:i=>r.quitarIntegrante(m)},null,8,["onClick"])])]))),128))])]),_:1,__:[12]})],512),[[M,o.integrantes.length]])]),_:1}),t("div",Te,[s(C,{label:"Registrar",type:"submit",color:"primary",unelevated:"",loading:o.submitting,disable:!r.selectedArea||o.integrantes.length===0},null,8,["loading","disable"]),s(C,{label:"Limpiar",flat:"",color:"grey-7",onClick:r.resetForm},null,8,["onClick"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})])]),s($,{showing:o.loadingAreas||o.submitting},{default:d(()=>[s(ee,{size:"40px"})]),_:1},8,["showing"])]),_:1})]),_:1})]),_:1})}const ze=O(le,[["render",Ue],["__scopeId","data-v-6c9b7306"]]);export{ze as default};
