import{_ as S,a2 as O,c as C,o as G,w as a,b as i,a as t,Q as d,e as c,a3 as p,t as _,a4 as f,a6 as g}from"./index-CN-uetH6.js";import{Q as k,a as q}from"./QInnerLoading-B8KQqIUH.js";import{Q}from"./QPage-ByXuMI-O.js";import{m as L}from"./vue3-apexcharts-DgsBzxaz.js";const N={name:"IndexPage",components:{apexchart:L},data(){return{loading:!1,areas:[],rows:[],totalAreas:0,totalGrupos:0,totalAlumnos:0,lastCreatedAt:"",areaAlumnosSeries:[],areaAlumnosOptions:{},areaGruposSeries:[],areaGruposOptions:{},insDiaSeries:[],insDiaOptions:{},cursosSeries:[],cursosOptions:{}}},mounted(){this.load()},methods:{async load(){this.loading=!0;try{const[o,s]=await Promise.all([this.$axios.get("/areas"),this.$axios.get("/inscritos")]);this.areas=o.data||[],this.rows=(s.data||[]).map(r=>this.normalizeRow(r)),this.buildKpis(),this.buildCharts()}catch{this.$q.notify({type:"negative",message:"No se pudo cargar el dashboard"})}finally{this.loading=!1}},normalizeRow(o){const s=[];for(let r=1;r<=10;r++)o[`estudiante${r}`]&&s.push({nombre:o[`estudiante${r}`],ci:o[`ci${r}`]||"",curso:o[`curso${r}`]||"",tutor:o[`tutor${r}`]||"",telefono:o[`telefono${r}`]||""});return{...o,_integrantes:s,_integrantesCount:s.length}},buildKpis(){this.totalAreas=this.areas.length,this.totalGrupos=this.rows.length,this.totalAlumnos=this.rows.reduce((s,r)=>s+(r._integrantesCount||0),0);const o=this.rows.map(s=>s.created_at).filter(Boolean).sort().slice(-1)[0];this.lastCreatedAt=o?this.$filters?.dateDmYHis?this.$filters.dateDmYHis(o):new Date(o).toLocaleString():""},buildCharts(){const o={},s={};this.rows.forEach(e=>{const n=e.area&&e.area.area?e.area.area:"Sin área";o[n]=(o[n]||0)+e._integrantesCount,s[n]=(s[n]||0)+1});const r=Object.keys(o),u=r.map(e=>o[e]),l=r.map(e=>s[e]);this.areaAlumnosSeries=[{name:"Alumnos",data:u}],this.areaAlumnosOptions={chart:{toolbar:{show:!1}},xaxis:{categories:r,labels:{rotateAlways:!1,trim:!0}},dataLabels:{enabled:!1},tooltip:{theme:"light"}},this.areaGruposSeries=l,this.areaGruposOptions={chart:{toolbar:{show:!1}},labels:r,legend:{position:"bottom"},dataLabels:{enabled:!0,formatter:e=>`${e.toFixed(1)}%`},tooltip:{theme:"light"}};const h={};this.rows.forEach(e=>{const n=new Date(e.created_at);if(!isNaN(n*1)){const y=n.toISOString().slice(0,10);h[y]=(h[y]||0)+e._integrantesCount}});const x=this.lastNDays(30).map(e=>e.key),v=x.map(e=>h[e]||0);this.insDiaSeries=[{name:"Alumnos",data:v}],this.insDiaOptions={chart:{toolbar:{show:!1}},stroke:{width:3,curve:"smooth"},xaxis:{categories:x},dataLabels:{enabled:!1},tooltip:{theme:"light"}};const b={};this.rows.forEach(e=>{(e._integrantes||[]).forEach(n=>{n.curso&&(b[n.curso]=(b[n.curso]||0)+1)})});const w=Object.entries(b).sort((e,n)=>n[1]-e[1]).slice(0,10),A=w.map(e=>e[0]),D=w.map(e=>e[1]);this.cursosSeries=[{name:"Alumnos",data:D}],this.cursosOptions={chart:{toolbar:{show:!1}},plotOptions:{bar:{horizontal:!0}},xaxis:{categories:A},dataLabels:{enabled:!1},tooltip:{theme:"light"}}},lastNDays(o){const s=[],r=new Date;for(let u=o-1;u>=0;u--){const l=new Date(r);l.setDate(r.getDate()-u);const h=l.toISOString().slice(0,10);s.push({key:h,d:l})}return s}}},I={class:"row q-col-gutter-md q-mb-md"},P={class:"col-12 col-sm-6 col-md-3"},z={class:"col q-ml-md"},B={class:"text-h6 text-weight-bold"},E={class:"col-12 col-sm-6 col-md-3"},R={class:"col q-ml-md"},V={class:"text-h6 text-weight-bold"},$={class:"col-12 col-sm-6 col-md-3"},j={class:"col q-ml-md"},H={class:"text-h6 text-weight-bold"},K={class:"col-12 col-sm-6 col-md-3"},Y={class:"col q-ml-md"},F={class:"text-subtitle2 text-weight-medium"},T={class:"row q-col-gutter-md"},J={class:"col-12 col-md-8"},M={class:"col-12 col-md-4"},U={class:"col-12 col-md-8"},W={class:"col-12 col-md-4"};function X(o,s,r,u,l,h){const m=O("apexchart");return G(),C(Q,{class:"q-pa-md bg-grey-3"},{default:a(()=>[i("div",I,[i("div",P,[t(d,{flat:"",bordered:"",class:"kpi-card"},{default:a(()=>[t(c,{class:"row items-center"},{default:a(()=>[t(p,{color:"primary","text-color":"white",icon:"dashboard"}),i("div",z,[s[0]||(s[0]=i("div",{class:"text-caption text-grey-7"},"Áreas",-1)),i("div",B,_(l.totalAreas),1)])]),_:1})]),_:1})]),i("div",E,[t(d,{flat:"",bordered:"",class:"kpi-card"},{default:a(()=>[t(c,{class:"row items-center"},{default:a(()=>[t(p,{color:"indigo","text-color":"white",icon:"assignment"}),i("div",R,[s[1]||(s[1]=i("div",{class:"text-caption text-grey-7"},"Grupos",-1)),i("div",V,_(l.totalGrupos),1)])]),_:1})]),_:1})]),i("div",$,[t(d,{flat:"",bordered:"",class:"kpi-card"},{default:a(()=>[t(c,{class:"row items-center"},{default:a(()=>[t(p,{color:"teal","text-color":"white",icon:"groups"}),i("div",j,[s[2]||(s[2]=i("div",{class:"text-caption text-grey-7"},"Alumnos",-1)),i("div",H,_(l.totalAlumnos),1)])]),_:1})]),_:1})]),i("div",K,[t(d,{flat:"",bordered:"",class:"kpi-card"},{default:a(()=>[t(c,{class:"row items-center"},{default:a(()=>[t(p,{color:"orange","text-color":"white",icon:"schedule"}),i("div",Y,[s[3]||(s[3]=i("div",{class:"text-caption text-grey-7"},"Último registro",-1)),i("div",F,_(l.lastCreatedAt||"—"),1)])]),_:1})]),_:1})])]),i("div",T,[i("div",J,[t(d,{flat:"",bordered:""},{default:a(()=>[t(c,{class:"text-subtitle1 text-weight-bold"},{default:a(()=>s[4]||(s[4]=[f(" Alumnos por área ")])),_:1,__:[4]}),t(g),t(c,null,{default:a(()=>[t(m,{type:"bar",height:"320",options:l.areaAlumnosOptions,series:l.areaAlumnosSeries},null,8,["options","series"])]),_:1})]),_:1})]),i("div",M,[t(d,{flat:"",bordered:""},{default:a(()=>[t(c,{class:"text-subtitle1 text-weight-bold"},{default:a(()=>s[5]||(s[5]=[f(" Grupos por área ")])),_:1,__:[5]}),t(g),t(c,null,{default:a(()=>[t(m,{type:"donut",height:"320",options:l.areaGruposOptions,series:l.areaGruposSeries},null,8,["options","series"])]),_:1})]),_:1})]),i("div",U,[t(d,{flat:"",bordered:"",class:"q-mt-md"},{default:a(()=>[t(c,{class:"text-subtitle1 text-weight-bold"},{default:a(()=>s[6]||(s[6]=[f(" Inscripciones por día (últimos 30) ")])),_:1,__:[6]}),t(g),t(c,null,{default:a(()=>[t(m,{type:"line",height:"300",options:l.insDiaOptions,series:l.insDiaSeries},null,8,["options","series"])]),_:1})]),_:1})]),i("div",W,[t(d,{flat:"",bordered:"",class:"q-mt-md"},{default:a(()=>[t(c,{class:"text-subtitle1 text-weight-bold"},{default:a(()=>s[7]||(s[7]=[f(" Cursos más inscritos ")])),_:1,__:[7]}),t(g),t(c,null,{default:a(()=>[t(m,{type:"bar",height:"300",options:l.cursosOptions,series:l.cursosSeries},null,8,["options","series"])]),_:1})]),_:1})])]),t(k,{showing:l.loading},{default:a(()=>[t(q,{size:"40px"})]),_:1},8,["showing"])]),_:1})}const ot=S(N,[["render",X],["__scopeId","data-v-d43e1467"]]);export{ot as default};
