import{Q as k}from"./QImg-CTbRexBC.js";import{j as E,O as L,l as B,ap as D,_ as O,c as V,o as c,w as d,a as s,b as t,a6 as F,Q as j,e as N,d as g,aj as P,a7 as b,ag as y,t as v,a4 as w,af as A,f as C,p as H,ah as R,ai as G,aw as M}from"./index-CZpypxI3.js";import{Q as Y}from"./QHeader-DQi44IGf.js";import{Q as U,a as z}from"./QFile-DK2a1Wpj.js";import{Q as J}from"./QTooltip-CjHo1Cv_.js";import{Q as K}from"./QSpace-cC2dd8am.js";import{Q as W}from"./QBanner-BBLcxXRf.js";import{Q as X}from"./QMarkupTable-yT1QohAt.js";import{Q as Z}from"./QForm-DQDZTDZY.js";import{Q as $,a as ee}from"./QInnerLoading-9b-C7_uX.js";import{Q as te}from"./QPage-Dlt9WEud.js";import{b as se,c as ae}from"./QLayout-Bwv_d4EJ.js";import{g as re}from"./inscripcion-pdf-MQiS4wL7.js";import"./QChip-DnE0UYGT.js";import"./QItemLabel-Cet9_Tik.js";import"./format-B-nPN110.js";const ne=E({name:"QSlideTransition",props:{appear:Boolean,duration:{type:Number,default:300}},emits:["show","hide"],setup(a,{slots:e,emit:u}){let h=!1,o,r,n=null,m=null,i,q;function x(){o?.(),o=null,h=!1,n!==null&&(clearTimeout(n),n=null),m!==null&&(clearTimeout(m),m=null),r?.removeEventListener("transitionend",i),i=null}function I(l,p,f){p!==void 0&&(l.style.height=`${p}px`),l.style.transition=`height ${a.duration}ms cubic-bezier(.25, .8, .50, 1)`,h=!0,o=f}function Q(l,p){l.style.overflowY=null,l.style.height=null,l.style.transition=null,x(),p!==q&&u(p)}function T(l,p){let f=0;r=l,h===!0?(x(),f=l.offsetHeight===l.scrollHeight?0:void 0):(q="hide",l.style.overflowY="hidden"),I(l,f,p),n=setTimeout(()=>{n=null,l.style.height=`${l.scrollHeight}px`,i=_=>{m=null,(Object(_)!==_||_.target===l)&&Q(l,"show")},l.addEventListener("transitionend",i),m=setTimeout(i,a.duration*1.1)},100)}function S(l,p){let f;r=l,h===!0?x():(q="show",l.style.overflowY="hidden",f=l.scrollHeight),I(l,f,p),n=setTimeout(()=>{n=null,l.style.height=0,i=_=>{m=null,(Object(_)!==_||_.target===l)&&Q(l,"hide")},l.addEventListener("transitionend",i),m=setTimeout(i,a.duration*1.1)},100)}return L(()=>{h===!0&&x()}),()=>B(D,{css:!1,appear:a.appear,onEnter:T,onLeave:S},e.default)}}),le={name:"RegistroGrupo",data(){return{areas:[],loadingAreas:!1,submitting:!1,selectedAreaId:null,grupoNombre:"",pagoFile:null,integrantes:[],maxAreas:3}},computed:{areaOptions(){return this.areas},selectedArea(){return this.areas.find(a=>a.id===this.selectedAreaId)||null},allowedCourses(){if(!this.selectedArea)return[];const a=[];for(let e=1;e<=6;e++){const u=this.selectedArea[`curso${e}`];u&&a.push({label:u})}return a},req(){return a=>!!a||"Obligatorio"}},mounted(){this.fetchAreas()},methods:{formatDate(a){if(!a)return"";try{const[e,u,h]=a.split("-").map(Number);return new Date(e,u-1,h).toLocaleDateString("es-BO",{year:"numeric",month:"long",day:"numeric"})}catch{return a}},async fetchAreas(){this.loadingAreas=!0;try{const{data:a}=await this.$axios.get("/areas");this.areas=a||[]}catch{this.$q.notify({type:"negative",message:"No se pudieron cargar las áreas"})}finally{this.loadingAreas=!1}},onAreaChange(){this.integrantes=[],this.selectedArea&&this.agregarIntegrante()},agregarIntegrante(){this.selectedArea&&(this.integrantes.length>=10||this.integrantes.push({nombre:"",ci:"",tutor:"",telefono:"",curso:"",_areasCount:void 0}))},quitarIntegrante(a){this.integrantes.splice(a,1)},async checkAreasPorCi(a){const e=this.integrantes[a]?.ci;if(e)try{const{data:u}=await this.$axios.get(`/inscritos/areas-por-ci/${encodeURIComponent(e)}`);this.integrantes[a]._areasCount=Number(u?.areas??0),this.integrantes[a]._areasCount>=this.maxAreas&&this.$q.notify({type:"warning",message:`El CI ${e} ya está en ${this.integrantes[a]._areasCount} área(s). Máximo permitido: ${this.maxAreas}.`})}catch{this.$q.notify({type:"warning",message:"No se pudo verificar áreas del CI"})}},async onSubmit(){if(!this.selectedAreaId||this.integrantes.length===0){this.$q.notify({type:"negative",message:"Completa área e integrantes"});return}for(const e of this.integrantes)if((e._areasCount??0)>=this.maxAreas){this.$q.notify({type:"negative",message:`El CI ${e.ci} superó el máximo de áreas`});return}const a=new FormData;a.append("area_id",this.selectedAreaId),this.grupoNombre&&a.append("grupo_nombre",this.grupoNombre),this.pagoFile&&a.append("pago1",this.pagoFile),this.integrantes.forEach((e,u)=>{a.append(`integrantes[${u}][nombre]`,e.nombre),a.append(`integrantes[${u}][ci]`,e.ci),a.append(`integrantes[${u}][tutor]`,e.tutor||""),a.append(`integrantes[${u}][telefono]`,e.telefono||""),a.append(`integrantes[${u}][curso]`,e.curso)}),this.submitting=!0;try{const e=await this.$axios.post("/inscritos",a,{headers:{"Content-Type":"multipart/form-data"}});this.$q.notify({type:"positive",message:"Inscripción registrada"}),re({inscrito:e.data?.inscrito||{},area:this.selectedArea,integrantes:this.integrantes,baseUrl:window.location.origin,assets:{left:"/images.png",right:"/logo_fni.png"}}),this.resetForm()}catch(e){const u=e?.response?.data?.message||"Error al registrar";this.$q.notify({type:"negative",message:u})}finally{this.submitting=!1}},resetForm(){this.selectedAreaId=null,this.grupoNombre="",this.pagoFile=null,this.integrantes=[]}}},oe={class:"row items-center q-py-sm q-px-md"},ie={class:"row q-col-gutter-md justify-center"},de={class:"col-12 col-md-10"},ue={class:"row q-col-gutter-md"},me={class:"col-12 col-md-6"},ce={key:0,class:"col-12 col-md-6"},ge={class:"row q-col-gutter-xs"},pe={key:0,class:"col-auto"},he={class:"bg-blue-9 q-pa-xs text-white text-weight-bold"},fe={key:1,class:"col-auto"},_e={class:"bg-green-9 q-pa-xs text-white text-weight-bold"},be={key:2,class:"col-auto"},ye={class:"bg-teal-9 q-pa-xs text-white text-weight-bold"},ve={key:3,class:"col-auto"},we={class:"bg-indigo-9 q-pa-xs text-white text-weight-bold"},Ae={class:"row q-col-gutter-md q-mt-sm"},xe={class:"col-12 col-md-6"},Ce={class:"col-12 col-md-6"},qe={class:"row items-center q-mt-md"},Ve={class:"q-mt-sm"},Ie={class:"text-grey-7"},Qe={style:{"min-width":"200px"}},ke={style:{"min-width":"140px"}},Fe={style:{"min-width":"130px"}},Ne={style:{"min-width":"170px"}},Ue={class:"text-right"},Te={class:"row q-mt-lg q-gutter-sm"};function Se(a,e,u,h,o,r){return c(),V(ae,{view:"lHh Lpr lFf"},{default:d(()=>[s(Y,{elevated:"",class:"bg-primary text-white"},{default:d(()=>[t("div",oe,[s(k,{src:"images.png",style:{width:"44px"},class:"q-mr-md"}),e[3]||(e[3]=t("div",{class:"col text-center"},[t("div",{class:"text-subtitle2"},"VIII OLIMPIADA DE"),t("div",{class:"text-h6 text-weight-bold"},"CIENCIA Y TECNOLOGÍA F.N.I.")],-1)),s(k,{src:"logo_fni.png",style:{width:"44px"}})]),s(F,{color:"white"})]),_:1}),s(se,null,{default:d(()=>[s(te,{class:"q-pa-md bg-grey-3"},{default:d(()=>[t("div",ie,[t("div",de,[s(j,{flat:"",bordered:"",class:"bg-white"},{default:d(()=>[s(N,{class:"row items-center"},{default:d(()=>[s(g,{name:"groups",size:"md",class:"q-mr-sm text-primary"}),e[4]||(e[4]=t("div",{class:"text-h6"},"Registro de Grupo",-1))]),_:1,__:[4]}),s(F),s(N,null,{default:d(()=>[s(Z,{onSubmit:P(r.onSubmit,["prevent"]),ref:"formRef"},{default:d(()=>[t("div",ue,[t("div",me,[s(U,{filled:"",dense:"",modelValue:o.selectedAreaId,"onUpdate:modelValue":[e[0]||(e[0]=n=>o.selectedAreaId=n),r.onAreaChange],options:r.areaOptions,"option-value":"id","option-label":"area","emit-value":"","map-options":"",label:"Selecciona el Área",loading:o.loadingAreas,rules:[n=>!!n||"El área es obligatoria"]},{prepend:d(()=>[s(g,{name:"school"})]),_:1},8,["modelValue","options","loading","rules","onUpdate:modelValue"])]),r.selectedArea?(c(),y("div",ce,[t("div",ge,[r.selectedArea.fecha1?(c(),y("div",pe,[t("div",he,v(r.selectedArea.titulo_fecha1||"Fecha 1")+": "+v(r.formatDate(r.selectedArea.fecha1)),1)])):b("",!0),r.selectedArea.fecha2?(c(),y("div",fe,[t("div",_e,v(r.selectedArea.titulo_fecha2||"Fecha 2")+": "+v(r.formatDate(r.selectedArea.fecha2)),1)])):b("",!0),r.selectedArea.lugar?(c(),y("div",be,[t("div",ye,[s(g,{name:"place",class:"q-mr-xs"}),w(" "+v(r.selectedArea.lugar),1)])])):b("",!0),r.selectedArea.modalidad?(c(),y("div",ve,[t("div",we,[s(g,{name:"meeting_room",class:"q-mr-xs"}),w(" "+v(r.selectedArea.modalidad),1)])])):b("",!0)])])):b("",!0)]),t("div",Ae,[t("div",xe,[s(A,{modelValue:o.grupoNombre,"onUpdate:modelValue":e[1]||(e[1]=n=>o.grupoNombre=n),label:"Nombre del Grupo (opcional)",filled:"",dense:"",maxlength:"255"},{prepend:d(()=>[s(g,{name:"badge"})]),_:1},8,["modelValue"])]),t("div",Ce,[s(z,{modelValue:o.pagoFile,"onUpdate:modelValue":e[2]||(e[2]=n=>o.pagoFile=n),label:"Comprobante de pago (png/jpg/pdf, máx 5MB)",filled:"",dense:"",counter:!0,accept:".png,.jpg,.jpeg,.pdf",clearable:""},{prepend:d(()=>[s(g,{name:"attach_file"})]),append:d(()=>[s(g,{name:"info",class:"cursor-pointer"},{default:d(()=>[s(J,null,{default:d(()=>e[5]||(e[5]=[w("Adjunta una imagen o PDF del pago")])),_:1,__:[5]})]),_:1})]),_:1},8,["modelValue"])])]),t("div",qe,[s(g,{name:"assignment_ind",class:"q-mr-sm text-primary"}),e[6]||(e[6]=t("div",{class:"text-subtitle1"},"Integrantes",-1)),s(K),s(C,{unelevated:"",color:"primary",icon:"person_add",label:"Agregar",onClick:r.agregarIntegrante,disable:!r.selectedArea||o.integrantes.length>=10},null,8,["onClick","disable"])]),r.selectedArea?(c(),V(W,{key:0,class:"q-mt-sm bg-grey-1"},{avatar:d(()=>[s(g,{name:"info",color:"primary"})]),default:d(()=>[e[7]||(e[7]=w(" Puedes registrar hasta ")),e[8]||(e[8]=t("b",null,"10",-1)),e[9]||(e[9]=w(" integrantes por grupo. Los ")),e[10]||(e[10]=t("b",null,"cursos",-1)),e[11]||(e[11]=w(" dependen del área seleccionada. "))]),_:1,__:[7,8,9,10,11]})):b("",!0),s(ne,null,{default:d(()=>[H(t("div",Ve,[s(X,{flat:"",bordered:""},{default:d(()=>[e[12]||(e[12]=t("thead",null,[t("tr",null,[t("th",null,"#"),t("th",null,"Nombre"),t("th",null,"CI"),t("th",null,"Tutor"),t("th",null,"Teléfono"),t("th",null,"Curso"),t("th")])],-1)),t("tbody",null,[(c(!0),y(R,null,G(o.integrantes,(n,m)=>(c(),y("tr",{key:m},[t("td",Ie,v(m+1),1),t("td",Qe,[s(A,{dense:"",filled:"",modelValue:n.nombre,"onUpdate:modelValue":i=>n.nombre=i,rules:[r.req]},null,8,["modelValue","onUpdate:modelValue","rules"])]),t("td",ke,[s(A,{dense:"",filled:"",modelValue:n.ci,"onUpdate:modelValue":i=>n.ci=i,rules:[r.req],onBlur:i=>r.checkAreasPorCi(m)},{append:d(()=>[n._areasCount!==void 0?(c(),V(g,{key:0,name:n._areasCount>=o.maxAreas?"warning":"check_circle",color:n._areasCount>=o.maxAreas?"orange":"positive"},null,8,["name","color"])):b("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue","rules","onBlur"])]),t("td",null,[s(A,{dense:"",filled:"",modelValue:n.tutor,"onUpdate:modelValue":i=>n.tutor=i},null,8,["modelValue","onUpdate:modelValue"])]),t("td",Fe,[s(A,{dense:"",filled:"",modelValue:n.telefono,"onUpdate:modelValue":i=>n.telefono=i},null,8,["modelValue","onUpdate:modelValue"])]),t("td",Ne,[s(U,{dense:"",filled:"",modelValue:n.curso,"onUpdate:modelValue":i=>n.curso=i,options:r.allowedCourses,"option-value":"label","option-label":"label","emit-value":"","map-options":"",rules:[r.req]},null,8,["modelValue","onUpdate:modelValue","options","rules"])]),t("td",Ue,[s(C,{flat:"",round:"",dense:"",icon:"delete",color:"negative",onClick:i=>r.quitarIntegrante(m)},null,8,["onClick"])])]))),128))])]),_:1,__:[12]})],512),[[M,o.integrantes.length]])]),_:1}),t("div",Te,[s(C,{label:"Registrar",type:"submit",color:"primary",unelevated:"",loading:o.submitting,disable:!r.selectedArea||o.integrantes.length===0},null,8,["loading","disable"]),s(C,{label:"Limpiar",flat:"",color:"grey-7",onClick:r.resetForm},null,8,["onClick"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})])]),s($,{showing:o.loadingAreas||o.submitting},{default:d(()=>[s(ee,{size:"40px"})]),_:1},8,["showing"])]),_:1})]),_:1})]),_:1})}const Xe=O(le,[["render",Se],["__scopeId","data-v-9f5a7f93"]]);export{Xe as default};
