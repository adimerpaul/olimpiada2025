import{Q as f}from"./QImg-DpsN3TG6.js";import{_ as g,c as d,o as u,w as r,a as s,Q as h,b as l,a7 as w,aj as y,af as c,d as n,b7 as b,f as x,a4 as k,t as Q}from"./index-BvqViaFu.js";import{Q as v}from"./QSpace-jpp_q1W5.js";import{Q as V,a as I}from"./QForm-n188TVHB.js";import{Q as L}from"./QPage-ibmn56CW.js";import{b as _,c as q}from"./QLayout-B6hBMmeb.js";const B={name:"Login",data(){return{email:"",password:"",showPwd:!1,remember:!0,loading:!1,error:"",checking:!1}},async mounted(){await this.redirectIfLogged()},methods:{async redirectIfLogged(){const i=localStorage.getItem("tokenOlim");if(i){this.checking=!0,this.$axios.defaults.headers.common.Authorization=`Bearer ${i}`;try{await this.$axios.get("/me"),this.$router.replace("/menu")}catch{localStorage.removeItem("tokenOlim"),delete this.$axios.defaults.headers.common.Authorization}finally{this.checking=!1}}},async onLogin(){if(this.error="",!!await this.$refs.formRef.validate()){this.loading=!0;try{const{data:e}=await this.$axios.post("/login",{username:this.email,password:this.password}),a=e?.token,m=e?.user;if(!a)throw new Error("Token no recibido");localStorage.setItem("tokenOlim",a),this.$store.user=m,this.$store.isLogged=!0,this.$axios.defaults.headers.common.Authorization=`Bearer ${a}`,this.$q.notify({type:"positive",message:"Bienvenido 游녦"}),this.$router.push("/menu")}catch(e){const a=e?.response?.data?.errors?.email?.[0]||e?.response?.data?.message||"No se pudo iniciar sesi칩n";this.error=a,this.$q.notify({type:"negative",message:a})}finally{this.loading=!1}}}}},C={class:"text-center q-mb-md"},P={class:"row items-center q-mt-sm"};function S(i,e,a,m,t,p){return u(),d(q,{view:"lHh Lpr lFf"},{default:r(()=>[s(_,null,{default:r(()=>[s(L,{class:"flex flex-center bg-grey-3"},{default:r(()=>[s(h,{bordered:"",flat:"",class:"q-pa-lg",style:{width:"100%","max-width":"420px"}},{default:r(()=>[l("div",C,[s(f,{src:"images.png",style:{width:"56px"},class:"q-mb-sm"}),e[4]||(e[4]=l("div",{class:"text-h6 text-weight-bold"},"Iniciar sesi칩n",-1)),e[5]||(e[5]=l("div",{class:"text-caption text-grey-7"},"VIII Olimpiada F.N.I.",-1))]),s(V,{onSubmit:y(p.onLogin,["prevent"]),ref:"formRef"},{default:r(()=>[s(c,{modelValue:t.email,"onUpdate:modelValue":e[0]||(e[0]=o=>t.email=o),type:"text",filled:"",dense:"",label:"Usuario",rules:[o=>!!o||"El correo es obligatorio"]},{prepend:r(()=>[s(n,{name:"mail"})]),_:1},8,["modelValue","rules"]),s(c,{modelValue:t.password,"onUpdate:modelValue":e[2]||(e[2]=o=>t.password=o),type:t.showPwd?"text":"password",filled:"",dense:"",label:"Contrase침a",class:"q-mt-sm",rules:[o=>!!o||"La contrase침a es obligatoria"]},{prepend:r(()=>[s(n,{name:"lock"})]),append:r(()=>[s(n,{name:t.showPwd?"visibility_off":"visibility",class:"cursor-pointer",onClick:e[1]||(e[1]=o=>t.showPwd=!t.showPwd)},null,8,["name"])]),_:1},8,["modelValue","type","rules"]),l("div",P,[s(b,{modelValue:t.remember,"onUpdate:modelValue":e[3]||(e[3]=o=>t.remember=o),label:"Recordarme",class:"text-grey-7"},null,8,["modelValue"]),s(v),s(x,{loading:t.loading,type:"submit",color:"primary",label:"Entrar",unelevated:""},null,8,["loading"])])]),_:1},8,["onSubmit"]),t.error?(u(),d(I,{key:0,class:"q-mt-md bg-red-1 text-red-10",rounded:""},{avatar:r(()=>[s(n,{name:"error",color:"red-10"})]),default:r(()=>[k(" "+Q(t.error),1)]),_:1})):w("",!0)]),_:1})]),_:1})]),_:1})]),_:1})}const E=g(B,[["render",S]]);export{E as default};
