import{Q as k}from"./QImg-p6hYnv2U.js";import{j as T,M as L,l as B,ap as D,_ as O,c as I,o as m,w as u,a as o,b as s,a6 as N,Q as j,e as U,d as _,aj as M,a7 as p,ag as h,t as b,a4 as x,af as g,f as A,n as P,ah as R,ai as z,aB as G}from"./index-DjedoNJp.js";import{Q as H}from"./QHeader-NxpRWtDt.js";import{Q as F,a as Y}from"./QFile-CDpWudWM.js";import{Q as J}from"./QSpace-DMjnhttB.js";import{Q as K}from"./QBanner-RyH8TlbD.js";import{Q as W}from"./QMarkupTable-CTS_xb0T.js";import{Q as X}from"./QForm-C-u9RR-8.js";import{Q as Z,a as $}from"./QInnerLoading-DaxcO_gM.js";import{Q as ee}from"./QPage-BGWxAykp.js";import{b as te,c as se}from"./QLayout-DZtfTCXW.js";import{a as re}from"./inscripcion-pdf-BHbUBJGX.js";import"./QChip-C0nkFCr8.js";import"./QItemLabel-pqPkR3Fl.js";import"./format-C8w485Ck.js";const ae=T({name:"QSlideTransition",props:{appear:Boolean,duration:{type:Number,default:300}},emits:["show","hide"],setup(t,{slots:e,emit:d}){let y=!1,l,r,a=null,c=null,i,q;function V(){l?.(),l=null,y=!1,a!==null&&(clearTimeout(a),a=null),c!==null&&(clearTimeout(c),c=null),r?.removeEventListener("transitionend",i),i=null}function C(n,f,v){f!==void 0&&(n.style.height=`${f}px`),n.style.transition=`height ${t.duration}ms cubic-bezier(.25, .8, .50, 1)`,y=!0,l=v}function Q(n,f){n.style.overflowY=null,n.style.height=null,n.style.transition=null,V(),f!==q&&d(f)}function S(n,f){let v=0;r=n,y===!0?(V(),v=n.offsetHeight===n.scrollHeight?0:void 0):(q="hide",n.style.overflowY="hidden"),C(n,v,f),a=setTimeout(()=>{a=null,n.style.height=`${n.scrollHeight}px`,i=w=>{c=null,(Object(w)!==w||w.target===n)&&Q(n,"show")},n.addEventListener("transitionend",i),c=setTimeout(i,t.duration*1.1)},100)}function E(n,f){let v;r=n,y===!0?V():(q="show",n.style.overflowY="hidden",v=n.scrollHeight),C(n,v,f),a=setTimeout(()=>{a=null,n.style.height=0,i=w=>{c=null,(Object(w)!==w||w.target===n)&&Q(n,"hide")},n.addEventListener("transitionend",i),c=setTimeout(i,t.duration*1.1)},100)}return L(()=>{y===!0&&V()}),()=>B(D,{css:!1,appear:t.appear,onEnter:S,onLeave:E},e.default)}}),oe={name:"RegistroGrupo",data(){return{areas:[],loadingAreas:!1,submitting:!1,selectedAreaId:null,grupoNombre:"",pagoFile:null,tutor_paterno:"",tutor_materno:"",tutor_nombre:"",tutor_celular:"",tutor_correo:"",colegio:"",ciudad:"",integrantes:[],maxAreas:3}},computed:{areaOptions(){return this.areas},selectedArea(){return this.areas.find(t=>t.id===this.selectedAreaId)||null},allowedCourses(){if(!this.selectedArea)return[];const t=[];for(let e=1;e<=6;e++){const d=this.selectedArea[`curso${e}`];d&&t.push({label:d})}return t},maxIntegrantes(){const t=Number(this.selectedArea?.max_integrantes);return Number.isFinite(t)&&t>0?t:10},minIntegrantes(){const t=Number(this.selectedArea?.min_integrantes);return Number.isFinite(t)&&t>0?t:1},req(){return t=>!!t||"Obligatorio"}},mounted(){this.fetchAreas()},methods:{formatDate(t){if(!t)return"";try{const[e,d,y]=t.split("-").map(Number);return new Date(e,d-1,y).toLocaleDateString("es-BO",{year:"numeric",month:"long",day:"numeric"})}catch{return t}},async fetchAreas(){this.loadingAreas=!0;try{const{data:t}=await this.$axios.get("/areas");this.areas=t||[]}catch{this.$q.notify({type:"negative",message:"No se pudieron cargar las áreas"})}finally{this.loadingAreas=!1}},onAreaChange(){this.integrantes=[],this.selectedArea&&this.agregarIntegrante()},agregarIntegrante(){this.selectedArea&&(this.integrantes.length>=this.maxIntegrantes||this.integrantes.push({apellidos:"",nombres:"",ci:"",telefono:"",curso:"",_areasCount:void 0}))},quitarIntegrante(t){this.integrantes.splice(t,1)},async checkAreasPorCi(t){const e=this.integrantes[t]?.ci;if(e)try{const{data:d}=await this.$axios.get(`/inscritos/areas-por-ci/${encodeURIComponent(e)}`);this.integrantes[t]._areasCount=Number(d?.areas??0),this.integrantes[t]._areasCount>=this.maxAreas&&this.$q.notify({type:"warning",message:`El CI ${e} ya está en ${this.integrantes[t]._areasCount} área(s). Máximo: ${this.maxAreas}.`})}catch{this.$q.notify({type:"warning",message:"No se pudo verificar áreas del CI"})}},async submitForm(){const t=new FormData;t.append("area_id",this.selectedAreaId),this.grupoNombre&&t.append("grupo_nombre",this.grupoNombre),this.pagoFile&&t.append("pago1",this.pagoFile),this.tutor_paterno&&t.append("tutor_paterno",this.tutor_paterno),this.tutor_materno&&t.append("tutor_materno",this.tutor_materno),this.tutor_nombre&&t.append("tutor_nombre",this.tutor_nombre),this.tutor_celular&&t.append("tutor_celular",this.tutor_celular),this.tutor_correo&&t.append("tutor_correo",this.tutor_correo),this.colegio&&t.append("colegio",this.colegio),this.ciudad&&t.append("ciudad",this.ciudad),this.integrantes.forEach((e,d)=>{t.append(`integrantes[${d}][apellidos]`,e.apellidos),t.append(`integrantes[${d}][nombres]`,e.nombres),t.append(`integrantes[${d}][ci]`,e.ci),t.append(`integrantes[${d}][telefono]`,e.telefono||""),t.append(`integrantes[${d}][curso]`,e.curso)}),this.submitting=!0;try{await this.$axios.post("/inscritos",t,{headers:{"Content-Type":"multipart/form-data"}}),this.$q.notify({type:"positive",message:"Inscripción registrada"}),re({tutor:{paterno:this.tutor_paterno,materno:this.tutor_materno,nombres:this.tutor_nombre,celular:this.tutor_celular,email:this.tutor_correo},colegio:{nombre:this.colegio,localidad:this.ciudad},grado:[...new Set(this.integrantes.map(e=>e.curso))].join(", "),estudiantes:this.integrantes.map(e=>({apellidos:e.apellidos,nombres:e.nombres,carnet:e.ci}))}),this.resetForm()}catch(e){const d=e?.response?.data?.message||"Error al registrar";this.$q.notify({type:"negative",message:d})}finally{this.submitting=!1}},async onSubmit(){if(!this.selectedAreaId||this.integrantes.length===0){this.$q.notify({type:"negative",message:"Completa área e integrantes"});return}if(this.integrantes.length<this.minIntegrantes){this.$q.notify({type:"warning",message:`Debes registrar al menos ${this.minIntegrantes} integrante(s).`});return}if(this.integrantes.length>this.maxIntegrantes){this.$q.notify({type:"warning",message:`Máximo permitido: ${this.maxIntegrantes} integrante(s) para esta área.`});return}for(const t of this.integrantes)if((t._areasCount??0)>=this.maxAreas){this.$q.notify({type:"negative",message:`El CI ${t.ci} superó el máximo de áreas`});return}if(this.selectedArea?.grupo_mismo_curso&&new Set(this.integrantes.map(e=>(e.curso||"").trim()).filter(Boolean)).size>1){this.$q.notify({type:"negative",message:"Esta área exige que todos los integrantes sean del mismo curso."});return}this.$q.dialog({cancel:!0,html:!0,ok:{label:"Sí, registrar",color:"primary"},message:`
          <div class="text-h6">Confirmar Registro</div>
          <div class="q-mt-sm">
            Una vez registrado, no podrás modificar los datos.<br/>
            <b>Nota:</b> Entregar el presente registro y realizar el pago de acuerdo a la convocatoria.
          </div>
        `,color:"primary",persistent:!0}).onOk(()=>this.submitForm())},resetForm(){this.selectedAreaId=null,this.grupoNombre="",this.pagoFile=null,this.tutor_paterno=this.tutor_materno=this.tutor_nombre="",this.tutor_celular=this.tutor_correo="",this.colegio=this.ciudad="",this.integrantes=[]}}},le={class:"row items-center q-py-sm q-px-md"},ne={class:"row q-col-gutter-md justify-center"},ie={class:"col-12 col-md-10"},de={class:"row q-col-gutter-md"},ue={class:"col-12 col-md-6"},me={key:0,class:"col-12 col-md-6"},ce={class:"row q-col-gutter-xs"},ge={key:0,class:"col-auto"},pe={class:"bg-blue-9 q-pa-xs text-white text-weight-bold"},he={key:1,class:"col-auto"},fe={class:"bg-green-9 q-pa-xs text-white text-weight-bold"},_e={key:2,class:"col-auto"},be={class:"bg-teal-9 q-pa-xs text-white text-weight-bold"},ye={key:3,class:"col-auto"},ve={class:"bg-indigo-9 q-pa-xs text-white text-weight-bold"},we={class:"row q-col-gutter-md q-mt-sm"},xe={class:"col-12 col-md-6"},Ve={class:"col-12 col-md-6"},Ae={class:"q-mt-md"},qe={class:"row q-col-gutter-md"},Ie={class:"col-12 col-md-4"},Ce={class:"col-12 col-md-4"},Qe={class:"col-12 col-md-4"},ke={class:"col-12 col-md-4"},Ne={class:"col-12 col-md-8"},Ue={class:"q-mt-md"},Fe={class:"row q-col-gutter-md"},Se={class:"col-12 col-md-8"},Ee={class:"col-12 col-md-4"},Te={class:"row items-center q-mt-md"},Le={key:0},Be={key:1},De={key:2},Oe={class:"q-mt-sm"},je={class:"text-grey-7"},Me={style:{"min-width":"180px"}},Pe={style:{"min-width":"180px"}},Re={style:{"min-width":"140px"}},ze={style:{"min-width":"130px"}},Ge={style:{"min-width":"160px"}},He={class:"text-right"},Ye={class:"row q-mt-lg q-gutter-sm"};function Je(t,e,d,y,l,r){return m(),I(se,{view:"lHh Lpr lFf"},{default:u(()=>[o(H,{elevated:"",class:"bg-primary text-white"},{default:u(()=>[s("div",le,[o(k,{src:"images.png",style:{width:"44px"},class:"q-mr-md"}),e[10]||(e[10]=s("div",{class:"col text-center"},[s("div",{class:"text-subtitle2"},"VIII OLIMPIADA DE"),s("div",{class:"text-h6 text-weight-bold"},"CIENCIA Y TECNOLOGÍA F.N.I.")],-1)),o(k,{src:"logo_fni.png",style:{width:"44px"}})]),o(N,{color:"white"})]),_:1}),o(te,null,{default:u(()=>[o(ee,{class:"q-pa-md bg-grey-3"},{default:u(()=>[s("div",ne,[s("div",ie,[o(j,{flat:"",bordered:"",class:"bg-white"},{default:u(()=>[o(U,{class:"row items-center"},{default:u(()=>[o(_,{name:"groups",size:"md",class:"q-mr-sm text-primary"}),e[11]||(e[11]=s("div",{class:"text-h6"},"Registro de Grupo",-1))]),_:1,__:[11]}),o(N),o(U,null,{default:u(()=>[o(X,{onSubmit:M(r.onSubmit,["prevent"]),ref:"formRef"},{default:u(()=>[s("div",de,[s("div",ue,[o(F,{filled:"",dense:"",modelValue:l.selectedAreaId,"onUpdate:modelValue":[e[0]||(e[0]=a=>l.selectedAreaId=a),r.onAreaChange],options:r.areaOptions,"option-value":"id","option-label":"area","emit-value":"","map-options":"",label:"Selecciona el Área",loading:l.loadingAreas,rules:[a=>!!a||"El área es obligatoria"]},{prepend:u(()=>[o(_,{name:"school"})]),_:1},8,["modelValue","options","loading","rules","onUpdate:modelValue"])]),r.selectedArea?(m(),h("div",me,[s("div",ce,[r.selectedArea.fecha1?(m(),h("div",ge,[s("div",pe,b(r.selectedArea.titulo_fecha1||"Fecha 1")+": "+b(r.formatDate(r.selectedArea.fecha1)),1)])):p("",!0),r.selectedArea.fecha2?(m(),h("div",he,[s("div",fe,b(r.selectedArea.titulo_fecha2||"Fecha 2")+": "+b(r.formatDate(r.selectedArea.fecha2)),1)])):p("",!0),r.selectedArea.lugar?(m(),h("div",_e,[s("div",be,[o(_,{name:"place",class:"q-mr-xs"}),x(" "+b(r.selectedArea.lugar),1)])])):p("",!0),r.selectedArea.modalidad?(m(),h("div",ye,[s("div",ve,[o(_,{name:"meeting_room",class:"q-mr-xs"}),x(" "+b(r.selectedArea.modalidad),1)])])):p("",!0)])])):p("",!0)]),s("div",we,[s("div",xe,[o(g,{modelValue:l.grupoNombre,"onUpdate:modelValue":e[1]||(e[1]=a=>l.grupoNombre=a),label:"Nombre del Grupo (opcional)",filled:"",dense:"",maxlength:"255"},{prepend:u(()=>[o(_,{name:"badge"})]),_:1},8,["modelValue"])]),s("div",Ve,[o(Y,{modelValue:l.pagoFile,"onUpdate:modelValue":e[2]||(e[2]=a=>l.pagoFile=a),label:"Comprobante de pago (png/jpg/pdf, máx 5MB)",filled:"",dense:"",counter:!0,accept:".png,.jpg,.jpeg,.pdf",clearable:""},{prepend:u(()=>[o(_,{name:"attach_file"})]),_:1},8,["modelValue"])])]),s("div",Ae,[e[12]||(e[12]=s("div",{class:"text-subtitle2 text-weight-bold q-mb-sm"},"Datos del Profesor(a) Tutor(a)",-1)),s("div",qe,[s("div",Ie,[o(g,{modelValue:l.tutor_paterno,"onUpdate:modelValue":e[3]||(e[3]=a=>l.tutor_paterno=a),label:"Apellido paterno",filled:"",dense:"",rules:[r.req]},null,8,["modelValue","rules"])]),s("div",Ce,[o(g,{modelValue:l.tutor_materno,"onUpdate:modelValue":e[4]||(e[4]=a=>l.tutor_materno=a),label:"Apellido materno",filled:"",dense:""},null,8,["modelValue"])]),s("div",Qe,[o(g,{modelValue:l.tutor_nombre,"onUpdate:modelValue":e[5]||(e[5]=a=>l.tutor_nombre=a),label:"Nombres",filled:"",dense:"",rules:[r.req]},null,8,["modelValue","rules"])]),s("div",ke,[o(g,{modelValue:l.tutor_celular,"onUpdate:modelValue":e[6]||(e[6]=a=>l.tutor_celular=a),label:"Celular",filled:"",dense:""},null,8,["modelValue"])]),s("div",Ne,[o(g,{modelValue:l.tutor_correo,"onUpdate:modelValue":e[7]||(e[7]=a=>l.tutor_correo=a),label:"Correo (Gmail)",type:"email",filled:"",dense:""},null,8,["modelValue"])])])]),s("div",Ue,[e[13]||(e[13]=s("div",{class:"text-subtitle2 text-weight-bold q-mb-sm"},"Unidad Educativa",-1)),s("div",Fe,[s("div",Se,[o(g,{modelValue:l.colegio,"onUpdate:modelValue":e[8]||(e[8]=a=>l.colegio=a),label:"Nombre de la unidad educativa",filled:"",dense:"",rules:[r.req]},null,8,["modelValue","rules"])]),s("div",Ee,[o(g,{modelValue:l.ciudad,"onUpdate:modelValue":e[9]||(e[9]=a=>l.ciudad=a),label:"Localidad / Ciudad",filled:"",dense:""},null,8,["modelValue"])])])]),s("div",Te,[o(_,{name:"assignment_ind",class:"q-mr-sm text-primary"}),e[14]||(e[14]=s("div",{class:"text-subtitle1"},"Integrantes",-1)),o(J),o(A,{unelevated:"",color:"primary",icon:"person_add",label:"Agregar",onClick:r.agregarIntegrante,disable:!r.selectedArea||l.integrantes.length>=r.maxIntegrantes},null,8,["onClick","disable"])]),r.selectedArea?(m(),I(K,{key:0,class:"q-mt-sm bg-grey-1"},{avatar:u(()=>[o(_,{name:"info",color:"primary"})]),default:u(()=>[e[15]||(e[15]=x(" Puedes registrar ")),r.minIntegrantes&&r.minIntegrantes>0?(m(),h("b",Le,b(r.minIntegrantes),1)):p("",!0),r.minIntegrantes&&r.minIntegrantes>0?(m(),h("span",Be," a ")):p("",!0),s("b",null,b(r.maxIntegrantes),1),e[16]||(e[16]=x(" integrantes por grupo. ")),r.selectedArea.grupo_mismo_curso?(m(),h("span",De," Todos los integrantes deben ser del mismo curso.")):p("",!0),e[17]||(e[17]=x(" Los ")),e[18]||(e[18]=s("b",null,"cursos",-1)),e[19]||(e[19]=x(" dependen del área seleccionada. "))]),_:1,__:[15,16,17,18,19]})):p("",!0),o(ae,null,{default:u(()=>[P(s("div",Oe,[o(W,{flat:"",bordered:""},{default:u(()=>[e[20]||(e[20]=s("thead",null,[s("tr",null,[s("th",null,"#"),s("th",null,"Apellidos"),s("th",null,"Nombres"),s("th",null,"CI"),s("th",null,"Teléfono"),s("th",null,"Curso"),s("th")])],-1)),s("tbody",null,[(m(!0),h(R,null,z(l.integrantes,(a,c)=>(m(),h("tr",{key:c},[s("td",je,b(c+1),1),s("td",Me,[o(g,{dense:"",filled:"",modelValue:a.apellidos,"onUpdate:modelValue":i=>a.apellidos=i,rules:[r.req]},null,8,["modelValue","onUpdate:modelValue","rules"])]),s("td",Pe,[o(g,{dense:"",filled:"",modelValue:a.nombres,"onUpdate:modelValue":i=>a.nombres=i,rules:[r.req]},null,8,["modelValue","onUpdate:modelValue","rules"])]),s("td",Re,[o(g,{dense:"",filled:"",modelValue:a.ci,"onUpdate:modelValue":i=>a.ci=i,rules:[r.req],onBlur:i=>r.checkAreasPorCi(c)},{append:u(()=>[a._areasCount!==void 0?(m(),I(_,{key:0,name:a._areasCount>=l.maxAreas?"warning":"check_circle",color:a._areasCount>=l.maxAreas?"orange":"positive"},null,8,["name","color"])):p("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue","rules","onBlur"])]),s("td",ze,[o(g,{dense:"",filled:"",modelValue:a.telefono,"onUpdate:modelValue":i=>a.telefono=i},null,8,["modelValue","onUpdate:modelValue"])]),s("td",Ge,[o(F,{dense:"",filled:"",modelValue:a.curso,"onUpdate:modelValue":i=>a.curso=i,options:r.allowedCourses,"option-value":"label","option-label":"label","emit-value":"","map-options":"",rules:[r.req]},null,8,["modelValue","onUpdate:modelValue","options","rules"])]),s("td",He,[o(A,{flat:"",round:"",dense:"",icon:"delete",color:"negative",onClick:i=>r.quitarIntegrante(c)},null,8,["onClick"])])]))),128))])]),_:1,__:[20]})],512),[[G,l.integrantes.length]])]),_:1}),s("div",Ye,[o(A,{label:"Registrar",type:"submit",color:"primary",unelevated:"",loading:l.submitting,disable:!r.selectedArea||l.integrantes.length<r.minIntegrantes},null,8,["loading","disable"]),o(A,{label:"Limpiar",flat:"",color:"grey-7",onClick:r.resetForm},null,8,["onClick"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})])]),o(Z,{showing:l.loadingAreas||l.submitting},{default:u(()=>[o($,{size:"40px"})]),_:1},8,["showing"])]),_:1})]),_:1})]),_:1})}const ut=O(oe,[["render",Je],["__scopeId","data-v-87c03194"]]);export{ut as default};
